<div class="min-h-screen bg-background p-4 sm:p-6">
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-4">
    <div class="flex items-center gap-3">
      <button
        (click)="goToDashboard()"
        class="inline-flex items-center justify-center p-2 text-black hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"
        title="Back to Dashboard"
        aria-label="Back to Dashboard">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
      </button>
      <h1 class="text-2xl font-bold">Products</h1>
    </div>
    <button (click)="openModal()" class="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition-colors">
      New Product
    </button>
  </div>

  <div class="border rounded shadow bg-white overflow-x-auto">
    <table class="w-full border min-w-[640px]">
      <thead>
        <tr class="bg-gray-100">
          <th class="p-2 text-left whitespace-nowrap">Name</th>
          <th class="p-2 text-left whitespace-nowrap">Description</th>
          <th class="p-2 text-left whitespace-nowrap">Price</th>
          <th class="p-2 text-left whitespace-nowrap">Stock</th>
          <th class="p-2 text-right whitespace-nowrap">Actions</th>
        </tr>
      </thead>
      <tbody>
        <!-- Loading State -->
        <tr *ngIf="isLoadingProducts">
          <td colspan="5" class="text-center p-8">
            <div class="flex flex-col items-center gap-3">
              <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-black"></div>
              <p class="text-sm text-gray-600">Loading products...</p>
            </div>
          </td>
        </tr>
        <!-- Empty State -->
        <tr *ngIf="!isLoadingProducts && products.length === 0">
          <td colspan="5" class="text-center text-gray-500 p-8">
            <div class="flex flex-col items-center gap-3">
              <svg class="w-16 h-16 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
              </svg>
              <p class="text-lg font-medium">No products found</p>
              <p class="text-sm">Click "New Product" to add your first product</p>
            </div>
          </td>
        </tr>
        <!-- Products Data -->
        <tr *ngFor="let product of products" class="border-t hover:bg-gray-50">
          <td class="p-2 whitespace-nowrap font-medium">{{ product.name }}</td>
          <td class="p-2">{{ product.description }}</td>
          <td class="p-2 whitespace-nowrap">R$ {{ product.price | number:'1.2-2' }}</td>
          <td class="p-2 whitespace-nowrap text-center">{{ product.stockQuantity }}</td>
          <td class="p-2 text-right whitespace-nowrap">
            <button
              (click)="editProduct(product)"
              class="inline-flex items-center justify-center p-2 text-black hover:text-gray-600 hover:bg-gray-100 rounded transition-colors"
              title="Edit product"
              aria-label="Edit product">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
              </svg>
            </button>
            <button
              (click)="deleteProduct(product.id!)"
              class="inline-flex items-center justify-center p-2 text-black hover:text-red-600 hover:bg-red-50 rounded transition-colors ml-1"
              title="Delete product"
              aria-label="Delete product">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <div *ngIf="!isLoadingProducts && products.length > 0" class="mt-4 flex flex-col sm:flex-row items-center justify-between gap-4">
    <!-- Page Size Selector -->
    <div class="flex items-center gap-2">
      <label class="text-sm text-gray-600">Items per page:</label>
      <select (change)="onPageSizeChange($event)" [value]="pageSize" class="border rounded p-1 text-sm focus:ring-2 focus:ring-black focus:border-black">
        <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
      </select>
      <span class="text-sm text-gray-600 ml-2">
        Showing {{ currentPage * pageSize + 1 }} to {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }}
      </span>
    </div>

    <!-- Page Navigation -->
    <div class="flex items-center gap-2">
      <button
        (click)="onPageChange(currentPage - 1)"
        [disabled]="currentPage === 0"
        class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Previous page">
        ‹
      </button>

      <button
        *ngFor="let page of visiblePages"
        (click)="onPageChange(page)"
        [class.bg-black]="page === currentPage"
        [class.text-white]="page === currentPage"
        [class.hover:bg-gray-100]="page !== currentPage"
        class="px-3 py-1 border rounded transition-colors">
        {{ page + 1 }}
      </button>

      <button
        (click)="onPageChange(currentPage + 1)"
        [disabled]="currentPage >= totalPages - 1"
        class="px-3 py-1 border rounded hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
        title="Next page">
        ›
      </button>
    </div>
  </div>

  <!-- Modal for Add/Edit Product -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
      <h2 class="text-xl font-bold mb-4">{{ isEditing ? 'Edit Product' : 'New Product' }}</h2>

      <form [formGroup]="productForm" (ngSubmit)="saveProduct()" class="space-y-4">
        <div>
          <label class="block text-sm font-medium mb-1">Name *</label>
          <input type="text" formControlName="name" class="w-full border p-2 rounded focus:ring-2 focus:ring-black focus:border-black" placeholder="Product name" />
          <span *ngIf="productForm.get('name')?.invalid && productForm.get('name')?.touched" class="text-red-500 text-xs">Name is required</span>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Description</label>
          <textarea formControlName="description" rows="3" class="w-full border p-2 rounded focus:ring-2 focus:ring-black focus:border-black" placeholder="Product description"></textarea>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Price *</label>
          <div class="relative">
            <span class="absolute left-3 top-2 text-gray-500">R$</span>
            <input
              type="text"
              formControlName="priceFormatted"
              (input)="onPriceInput($event)"
              (blur)="onPriceBlur()"
              class="w-full border p-2 pl-10 rounded focus:ring-2 focus:ring-black focus:border-black"
              placeholder="0,00" />
          </div>
          <span *ngIf="productForm.get('price')?.invalid && productForm.get('price')?.touched" class="text-red-500 text-xs">Price is required and must be positive</span>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Stock Quantity *</label>
          <input type="number" formControlName="stockQuantity" min="0" class="w-full border p-2 rounded focus:ring-2 focus:ring-black focus:border-black" placeholder="0" />
          <span *ngIf="productForm.get('stockQuantity')?.invalid && productForm.get('stockQuantity')?.touched" class="text-red-500 text-xs">Stock quantity is required and must be positive</span>
        </div>

        <div class="flex gap-3 pt-2">
          <button type="submit" [disabled]="productForm.invalid" class="flex-1 bg-black text-white py-2 rounded hover:bg-gray-800 transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
            {{ isEditing ? 'Update' : 'Create' }}
          </button>
          <button type="button" (click)="closeModal()" class="flex-1 border border-black text-black py-2 rounded hover:bg-gray-100 transition-colors">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
